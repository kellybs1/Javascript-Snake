<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Javascript Snakee</title>
    <link rel="stylesheet" href="style.css">
    <div id="greeting">Welcome to snake</div>
    <div id="instructions"> Use arrow keys to move
	  <br> Eat frogs to grow
      <br> Don't bite yourself or fall off a cliff
    </div>
    <canvas id="myCanvas" width="480" height="340" style="border:1px solid #000000;"></canvas>
    <script>
      function main() {
        var scoreMain = 0;
        var scoreMove = 1;
        var scoreEat = 1000;
        var direction;
        var blockSize = 20;
        var timerTick = 100;
        var snakeTails = [];
        var c = document.getElementById("myCanvas");
        var board = c.getContext("2d");
        var centerWidth = c.width / 2;
        var centerHeight = c.height / 2;
        var snake = {xPos: centerWidth, yPos: centerWidth - blockSize, size: blockSize, colour: '#FF9933'}
        var frog = {xPos: 0, yPos: 0, size: blockSize, alive: false, colour: '#006600'}
        function clearScreen() {
          board.clearRect(0, 0, c.width, c.height);
        }
        function drawBlock(xPos, yPos, fillColour) {
          board.fillStyle = fillColour;
          board.fillRect(xPos, yPos, blockSize, blockSize);
          board.strokeRect(xPos, yPos, blockSize, blockSize);
        }
        //from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random
        // Returns a random integer between min (included) and max (included)
        function getRandomIntInclusive(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        //picks a new spot for frog if it is not already spawned
        function moveFrog() {
          if (frog.alive == false) {
            do {
              frog.xPos = getRandomIntInclusive(blockSize, c.width - (blockSize * 2));
              frog.yPos = getRandomIntInclusive(blockSize, c.height - (blockSize * 2));
              //while positions are multiples of blocksize and this position isn't inside snake
            } while ((blockSizeMultiple(frog.xPos, frog.yPos) == false) || (checkFrogSpawnClear(frog.xPos, frog.yPos) == false))
              frog.alive = true;
          }
        }
        //Checks that chosen spawn point isn't inside snake
        function checkFrogSpawnClear(xPos, yPos) {
          var clear = true;
          for (i = 0; i < snakeTails.length; i++) {
            if (xPos == snakeTails[i].xPos && yPos == snakeTails[i].yPos) {
              clear = false;
            }
          }
          return clear;
        }
        //Checks that position values are multiples of blocksize
        function blockSizeMultiple(xPos, yPos) {
          var isMultiple = true;
          if (xPos % blockSize > 0 || xPos % blockSize < 0 || yPos % blockSize > 0 || yPos % blockSize < 0) {
            isMultiple = false;
          }
          return isMultiple;
        }
        //checks for snake going outside of bounds
        function checkWallCollision() {
          if (snake.xPos < 0 || snake.xPos >= c.width || snake.yPos < 0 || snake.yPos >= c.height) {
            gameOver();
          }
        }
        //check for snake colliding with food
        function checkFrogSnakeCollision() {
          if (snake.xPos == frog.xPos && snake.yPos == frog.yPos) {
            frog.alive = false;
            scoreByEating();
            growSnake();
          }
        }
        //adds current position to snake tail array
        function growSnake() {
          snakeTails.push({
            xPos: snake.xPos,
            yPos: snake.yPos
          });
        }
        //draws tails of snakes
        function drawSnakeTails() {
          for (i = 1; i < snakeTails.length; i++) {
            drawBlock(snakeTails[i].xPos, snakeTails[i].yPos, snake.colour);
          }
        }
        //moves each tail section into the position of the section ahead of it
        function followSnakeTails() {
          for (i = snakeTails.length - 1; i >= 1; i--) {
            snakeTails[i].xPos = snakeTails[i - 1].xPos;
            snakeTails[i].yPos = snakeTails[i - 1].yPos;
          }
        }
        function checkSnakeSelfCollision() {
          //do not check for collision with 1st tail block, allows "turning around" with 2-block-only snkme
          for (i = 2; i < snakeTails.length; i++) {
            if (snake.xPos == snakeTails[i].xPos && snake.yPos == snakeTails[i].yPos) {
              gameOver();
            }
          }
        }
        //score by eating a frog
        function scoreByEating() {
          scoreMain += scoreEat;
        }
        //score for each movement, a "lifetime" score
        function scoreByMoving() {
          if (direction > 0) {
            scoreMain += scoreMove;
          }
        }
        function updateScore() {
          document.getElementById("scoreOut").innerHTML = "Score: " + scoreMain;
        }
        function gameOver() {
          direction = 0;
          clearInterval(myTicker);
          document.getElementById("status").innerHTML = "Game Over!";
        }
        //moves snake in direction of current key press, used in tandem with document.body.onkeydown event
        function moveSnake() {
          switch (direction) {
            case 1:
              snake.yPos -= blockSize;
              break;

            case 2:
              snake.xPos += blockSize;
              break;

            case 3:
              snake.yPos += blockSize;
              break;

            case 4:
              snake.xPos -= blockSize;
              break;
          }
          //set first array item to new current position -> tails follow this point
          setSnakeHeadPosition();
          scoreByMoving();
        }
        //reset snake head position in array
        function setSnakeHeadPosition() {
          snakeTails[0] = {
            xPos: snake.xPos,
            yPos: snake.yPos
          };
        }
        //translates arrow keys (38,39,40,41) to direction choices
        document.body.onkeydown = function(e) {
          var event = window.event ? window.event : e;
          switch (event.keyCode) {
            case 38:
              direction = 1;
              break;

            case 39:
              direction = 2;
              break;

            case 40:
              direction = 3;
              break;

            case 37:
              direction = 4;
              break;
          }
        }
        //main timer event to run functions each tick
        var myTicker = setInterval(tickEvents, timerTick);
        function tickEvents() {
          clearScreen();
          moveSnake();
          drawBlock(snake.xPos, snake.yPos, snake.colour);
          checkSnakeSelfCollision();
          moveFrog();
          drawBlock(frog.xPos, frog.yPos, frog.colour);
          checkWallCollision();
          checkFrogSnakeCollision();
          drawSnakeTails();
          followSnakeTails();
          updateScore();
        }
      }
    </script>
  </head>
  <body onload="main();">
    <!-- Sets up divs for score output and game over text -->
    <div id="scoreOut"> </div>
    <div id="status"> </div>
  </body>
</html>
